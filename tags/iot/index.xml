<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>IOT on araboud.ca</title><link>https://araboud.ca/tags/iot/</link><description>Recent content in IOT on araboud.ca</description><generator>Hugo -- gohugo.io</generator><copyright>Copyright © 2008–2021, Alex Raboud; all rights reserved.</copyright><lastBuildDate>Thu, 25 Feb 2021 00:00:00 -0700</lastBuildDate><atom:link href="https://araboud.ca/tags/iot/index.xml" rel="self" type="application/rss+xml"/><item><title>Fish Light Control</title><link>https://araboud.ca/projects/fish-light-control/</link><pubDate>Thu, 25 Feb 2021 00:00:00 -0700</pubDate><guid>https://araboud.ca/projects/fish-light-control/</guid><description>
&lt;p>This was a quick project to have an esp32 control a light strip over our fish tank. It was nice to keep the scope small and finish it off in a few days. Our aquarium had a small LED strip light on a rocker switch and I had just picked up a length of WS2812 addressable LED, so this seemed like a good opportunity to try them out.&lt;/p>
&lt;p>I debated on using a Raspberry Pi Zero and look at integrating it as a IOT device, but I ended up going pretty minimalist by making it all timer based with an esp32 dev kit. I put together a schematic and design in Eagle CAD. This makes for good practice and it tends to save soldering re-work when I have a good diagram to work with.&lt;/p>
&lt;p>&lt;img src="https://araboud.ca/imgs/fishlightcontrol/FishControlBoard.png" alt="Drawing of board from Eagle CAD">&lt;/p>
&lt;p>The WS2812 strip runs on 5v and the esp32 data is 3.3v so I needed a level shifter. The data rate is pretty quick at 800khz so a simple level shifter wouldn't do the trick. Apparently I might have gotten away with just using 3.3v data, but I ended up getting an inverter (SN74HCT04N) instead to shift to 5v. GPIO 17 on the esp32 goes to the first input, the inverted signal loops back to its second input, and the second output is the right polarity and voltage for the lights, saving me needing to invert it in software.&lt;/p>
&lt;p>&lt;img src="https://araboud.ca/imgs/fishlightcontrol/FishControlBoardSoldered.png" alt="Soldered prototype board">&lt;/p>
&lt;p>It was a bit greedy to skip a full breadboard setup, but the circuit was simple enough that I could jump to a prototype board like this. It turned out okay with the only real changes being the added pullup resistor and a different style connector for the LED strip.&lt;/p>
&lt;p>Next I wrote &lt;a href="https://github.com/ataboo/fish-light-control">the software to drive the controller&lt;/a> using ESP-IDF. Lucky for me, they had a WS2812 example for the RMT library so it was pretty straight forward to implement. I set it up to startup the WIFI every 24 hours and update the clock and update the color according to the time every minute. A noon color is set and it ramps up and down during the configured sunrise/sunset periods. I was impressed how easy it was to sleep and wake in esp-idf. I could definately see this being a good option for battery powered projects.&lt;/p>
&lt;p>Next I designed a case for the board in Fusion and found a couple nice SVGs to represent the 2 end users.&lt;/p>
&lt;p>&lt;img src="https://araboud.ca/imgs/fishlightcontrol/FishControlCasePrinted.png" alt="3d Printed case for the control board">&lt;/p>
&lt;p>I printed the case in wood PLA and everything fit pretty well.&lt;/p>
&lt;p>One thing I ran into was the lights flickering colours sometimes when I would handle the board. After trying a few things, I ended up fixing it by adding an external pull-down resistor between the GPIO and the inverter.&lt;/p>
&lt;p>&lt;img src="https://araboud.ca/imgs/fishlightcontrol/FishControlLightAndController.png" alt="The LED strip and controller">&lt;/p>
&lt;p>Overall was a nice quick project. I look forward to coming up with new uses for the WS2812s.&lt;/p>
&lt;p>&lt;a href="https://github.com/ataboo/fish-light-control">fish-light-control on Github&lt;/a>&lt;/p>
&lt;p>&lt;strong>Update: 2021-03-14&lt;/strong>&lt;/p>
&lt;p>The original light seems to work great and it's nice to be able to tune the tone and brightness. It seems like stock lights are more about showing off the fish but that kind of brightness has to be annoying for them. We ended up getting 3 new fish and tanks, so I've cleaned up the PCB a bit to have a few boards manufactured.&lt;/p>
&lt;p>&lt;img src="https://araboud.ca/imgs/fishlightcontrol/FishLightBoard_v1.0_render.png" alt="A render of the breakout board sent to manufacturing">&lt;/p>
&lt;p>The only major change is trying out the holes for strain relief and direct soldering to the board.&lt;/p></description></item></channel></rss>